{% extends 'layouts/base.html' %}
{% load static %}
{% block content %}


<!-- CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<form enctype="multipart/form-data" class="container" method="post" id="servicio_form">
    {% csrf_token %}
    <!-- main form start - detalles del servicio -->
    <div class="card">
        <div class="card-header card-header-secondary">
            <h4 class="card-title">Agregar Servicio</h4>
        </div>
        {% for field in form %}
        <div class="form-group card-body">
            <label>{{field.label}}</label>
            {% if field.field.required %}
            <span style="color: red;" class="required">*</span>
            {% endif %}
            {{field}}
            {% for error in field.errors %}
            <p style="color: red">{{ error }}</p>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
    <!-- main form end - detalles del servicio -->

    <!-- formset para agregar asistentes -->

    {{ formset.management_form }}
    <script type="text/html" id="asistentes-template">
        <div class="card-body" id="asistentes-__prefix__">
            {% for field in formset.empty_form %}
            <div class="form-group">
                <label>{{ field.label }}</label>
                {{ field }}
                {% for error in field.errors %}
                <p style="color: red">{{ error }}</p>
                {% endfor %}
            </div>
            {% endfor %}
            <button type="button" class="btn btn-danger btn-sm" onclick="removeAsistente(__prefix__);">Eliminar</button>
        </div>
    </script>

    <div class="card mt-4">
        <div class="card-header card-header-secondary">
            <h4 class="card-title">Agregar Asistentes</h4>
        </div>
        <div class="card-body" id="asistentes-formset">
            {% for form in formset %}
            <div class="form-group">
                <label>{{ form.asistente.label }}</label>
                {{ form.asistente }}
                {% for error in form.asistente.errors %}
                <p style="color: red">{{ error }}</p>
                {% endfor %}
                <button type="button" class="btn btn-danger btn-sm"
                    onclick="removeAsistente('{{ forloop.counter0 }}');">Eliminar</button>
            </div>
            {% endfor %}
            <button type="button" class="btn btn-secondary btn-sm" onclick="addAsistente();">Agregar Asistente</button>
        </div>
    </div>
    <!-- formset para agregar asistentes -->

    <div class="form-group mt-4">
        <button type="submit" class="btn btn-secondary btn-block">Guardar</button>
    </div>
</form>

<script>
    function addAsistente() {
        const formsetDiv = document.getElementById('asistentes-formset');
        const formsetTemplate = document.getElementById('asistentes-template').innerHTML;
        const formsetPrefix = '__prefix__';
        const nextIndex = formsetDiv.childElementCount;
        const formsetHTML = formsetTemplate.replace(new RegExp(formsetPrefix, 'g'), nextIndex);
        formsetDiv.insertAdjacentHTML('beforeend', formsetHTML);
    }

    function removeAsistente(index) {
        const formsetDiv = document.getElementById('asistentes-formset');
        const formsetId = `asistentes-${index}`;
        const formsetElement = document.getElementById(formsetId);

        if (formsetElement) {
            formsetDiv.removeChild(formsetElement);
        }
    }
</script>
{% endblock content %}