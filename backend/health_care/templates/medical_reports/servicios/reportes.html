{% extends 'layouts/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<!-- Carga de jQuery -->
<!-- Carga de jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- CSS -->
<div class="col-xl-12 col-md-6">
    <div class="card Recent-Users">
        <div class="card-header">
            <div class="float-left">
                <img src="{% static 'assets/images/surgy1.2.png' %}" alt="Logo" style="max-width: 25%; "
                    class="float-left">
            </div>
        </div>
    </div>
</div>
<div class="col-12">
    <div class="alert-container">
        {% if messages %}
        {% for message in messages %}
        <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% endif %}"
            role="alert">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
    </div>
</div>
<div class="col-xl-12 col-md-6">
    <div class="alert alert-success" role="alert" id="myAlert">
        El proceso de completar los pagos se efectúa una vez que los asistentes hayan proporcionado sus respectivas
        facturas.
    </div>
    <div class="card Recent-Users">
        <a href="{% url 'lista_reportes_pagados' %}" class="nav-link"> <i class="feather icon-file-text"></i>
            Reporte servicios pagados a asistentes
        </a>
        <div class="card">

            <div class="card-header">
                <form method="post" action="{% url 'procesar_pagos' %}" class="row g-3 needs-validation" novalidate>
                    {% csrf_token %}
                    <div class="col-md-5">
                        <label for="validationCustom01" class="form-label">Fecha inicial</label>
                        <input type="date" class="form-control" id="rango_fecha_inicio" name="rango_fecha_inicio"
                            required>
                        <div class="invalid-feedback">
                            Campo requerido
                        </div>
                    </div>
                    <div class="col-md-5">
                        <label for="validationCustom02" class="form-label">Fecha cierre</label>
                        <input type="date" class="form-control" id="rango_fecha_fin" name="rango_fecha_fin" required>
                        <div class="invalid-feedback">
                            Campo requerido
                        </div>
                    </div>

                    <div class="col-md-2">
                        <label for="validationCustom01" class="form-label" style="color:white">Generar pago</label>
                        <button type="submit" class="btn btn-primary mb-2">Generar pagos</button>
                    </div>
                </form>
                <div class="card-block px-0 py-3">
                    <div class="table-responsive">
                        <table class="table table-hover" id="miTabla">
                            <thead>
                                <tr>
                                    <th scope="col">FECHA</th>
                                    <th scope="col">TIPO SERVICIO</th>
                                    <th scope="col">FORMA DE PAGO</th>
                                    <th scope="col">FACTURA ASEGURADORA</th>
                                    <th scope="col">PROCESO DEL SERVICIO</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for servicios in servicios_list %}
                                <tr class="parent">
                                    <td>
                                        <p class="m-0">{{ servicios.Fecha }}</p>
                                    </td>
                                    <td>
                                        <p class="m-0">{{ servicios.CodCostoOperacion }}</p>
                                    </td>
                                    <td>
                                        <p class="m-0">{{ servicios.MedioPago }}</p>
                                    </td>
                                    <td>
                                        <p class="m-0">{{ servicios.EstadoPago }}</p>
                                    </td>
                                    <td>
                                        {% if servicios.EstadoCierre%}

                                        <p class="m-0 text-c-blue"><i
                                                class="fas fa-circle text-c-green f-10 m-r-15"></i>
                                            Cerrada</p>
                                        {% else %}

                                        <p class="m-0 text-c-red"><i class="fas fa-circle text-c-red f-10 m-r-15"></i>
                                            En proceso</p>
                                        {% endif %}
                                    </td>


                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1040;
            display: none;
            /* Ocultar inicialmente */
        }

        /* Estilos para el contenido del modal */
        .custom-modal {
            background-color: white;
            width: 70%;
            max-width: 500px;
            margin: 100px auto;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/datetime/1.1.1/css/dataTables.dateTime.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/datetime/1.1.1/js/dataTables.dateTime.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"></script>
    <!-- Incluye Moment.js -->
    <script type="text/javascript" charset="utf8"
        src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>
        $(document).ready(function () {
            var miTabla = $('#miTabla').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json",
                    searchBuilder: {
                        add: 'Añadir',
                        condition: 'Condición',
                        clearAll: 'Borrar todo',
                        delete: 'Eliminar',
                        deleteTitle: 'Eliminar título',
                        data: 'Columna',
                        left: 'Izquierda',
                        leftTitle: 'Título izquierdo',
                        logicAnd: 'Y',
                        logicOr: 'O',
                        right: 'Derecha',
                        rightTitle: 'Título derecho',
                        title: {
                            0: 'Filtros',
                            _: 'Filtros (%d)'
                        },
                        value: 'Opción',
                        conditions: {
                            "date": {
                                "after": "Después",
                                "before": "Antes",
                                "between": "Entre",
                                "empty": "Vacío",
                                "equals": "Igual a",
                                "not": "No",
                                "notBetween": "No entre",
                                "notEmpty": "No vacío"
                            },
                            "number": {
                                ">=": ">=",
                                "<=": "<=",
                                "<>": "<>",
                                "=": "=",
                                ">": ">",
                                "<": "<",
                                between: "Entre",
                                empty: "Vacío",
                                equals: "Igual a",
                                notBetween: "No entre",
                                notEmpty: "No vacío"
                            },
                            // ... otras condiciones
                        }
                    }
                },
                responsive: true,
                "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "Todos"]],
                dom: 'Qfrtip',
                searchBuilder: true,
            });

            $('#miTabla_length select').on('change', function () {
                var selectedValue = $(this).val();
                if (selectedValue === '5') {
                    miTabla.page.len(5).draw();
                }
            });
            // Espera 2 segundos (2000 milisegundos) antes de mostrar la alerta
            setTimeout(function () {
                var myAlert = document.getElementById('myAlert');
                myAlert.style.display = 'block'; // Muestra la alerta
            }, 120000);

        });
        function deleteservices(id) {
            // Solicitar al servidor eliminar el servicio con el ID proporcionado
            $.ajax({
                type: "POST",
                url: "{% url 'delete_servicio' 0 %}".replace('0', id),
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                },
                success: function () {
                    $('#row-' + id).remove();
                },
                error: function () {
                    alert('Error al eliminar.');
                },
            });
        }

        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }

                        form.classList.add('was-validated')
                    }, false)
                })
        })()



    </script>
    {% endblock content %}